
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru-ru" lang="ru-ru" >
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="VIZ, блог, блокчейн, блоггеры, социальная сеть, апвот, поощрение, лайки, контент, децентрализация" />
		<meta name="rights" content="(с) Joopiter.ru и denis-skripnik.name" />
		<meta name="description" content="Live blogs space - web-клиент для блокчейна VIZ, платформы для блоггеров. Его главным преимуществом является то, что он локальный, а также имеет свою экономику распределения вознаграждений (СМ. about.html)" />
		
		<title>Изменить профиль | Live blogs space</title>
		
		<link href="favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
		<link href="css/view.css" rel="stylesheet" type="text/css" />
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link href="css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
		<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />
		<link href="css/bootstrap/bootstrap-social.css" rel="stylesheet" type="text/css" />
		<link href="css/bootstrap/fileinput.css" rel="stylesheet" type="text/css" />
		<link href="css/font-exo-cyrillic.css" rel="stylesheet" type="text/css" />
		<link href="css/1vtemplate.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="css/editormd.min.css" />
		
		<script src="js/lib/jquery.min.js"></script>
		<script src="js/lib/jquery-ui.min.js"></script>		
		<script src="js/lib/sjcl.min.js" type="text/javascript"></script>
		<script src="js/lib/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="js/lib/fileinput.min.js" type="text/javascript"></script>
		<script src="js/1vtemplate.js" type="text/javascript"></script>

		<script src="https://cdn.jsdelivr.net/npm/viz-world-js@0.9.9/dist/viz.min.js" type="text/javascript"></script>
		<script src="js/marked.js" type="text/javascript"></script>
		<script src="js/moment.js" type="text/javascript"></script>
		<script src="js/vizhelper.js" type="text/javascript"></script>
		
		<script src="js/view.js" type="text/javascript"></script>
		<script src="js/editormd.min.js" type="text/javascript"></script>
		<script language="javascript" type="text/javascript"></script>
	</head>
	
	<style type="text/css" media="screen">
		#editor { 
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
		}
	</style>	
	<body class="body">
	<header id="header_wrapper" class="mp_header_wrapper">
			<nav id="header" class="navbar navbar-default radiusless">
				<div class="main_wrapper">
					<div class="navbar-header">
						<button type="button" id="main-menu_btn" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu" aria-expanded="false">
							<span class="sr-only">Главное меню</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div class="collapse navbar-collapse" id="main-menu">
					</div>
				</div>
			</nav>
        </header>
		<div id="principal_wrapper">
			<div class="main_wrapper">
				<aside id="sidebar_left">
					<div id="main_logo_wrapper">
						<a href="index.html" id="logo_link"><img src="images/logo.png" class="img-responsive" alt="Live blogs space" title="Live blogs space"/></a>
					</div>
					<div id="login_div" class="row" style="margin-top: 5px; margin-bottom: 10px; display: none;">
						<form action="" method="post" name="adminForm" id="adminForm" class="form-validate col-sm-10 col-sm-offset-1">
								<div class="form-group1">
									<label for="login" style="color: white;">Логин VIZ<span style="color: red;">*</span> </label>
									<div class="input-group">
										<div class="input-group-addon">@</div>
										<input type="text" class="form-control required" id="login" name="login" onblur="checkLogin(this.value);" required="required"> 
									</div>
								</div>
								<div class="form-group1">
									<label for="key" style="color: white;">Постинг ключ</label> <span style="color: red;">*</span> 
									<input type="password" class="form-control required" id="key" name="key" placeholder="Начинается с 5" required="required">
								</div>
								<br>
								<div class="center" style="text-align: center;">
									<input type="hidden" name="ok" id="ok" value="false">
									<input type="button" class="btn btn-primary" value="Войти" onclick="storeKeyLocally();">
								</div>
						</form>
					</div>

					<div id="avatar">
						<div id="hello"></div>
						<div id="battery"></div>
					</div>
				</aside>
				<div id="main_content_wrapper">
					<section id="main_content">
						
						<div id="main_column_wrapper">
							<div id="main_column">																	
								<ol itemscope itemtype="https://schema.org/BreadcrumbList" class="breadcrumb">
									<li>
										Вы здесь: &#160;
									</li>	
									<li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" class="active">
										<span itemprop="name">
											Изменение профиля				
										</span>
										<meta itemprop="position" content="1">
									</li>
								</ol>
								<div id="j_component">									
<h1>Изменение публичного профиля</h1>
									<form class="profile-update" action="" name="postForm" method="POST" id="postForm" onsubmit="return false">
<h2>Основное:</h2>
										<div class="form-group1">
											<p><label for="name">Отображаемое имя (публичное)</label></p>
											<p><input type="text" class="form-control required" placeholder="Псевдоним или Имя Фамилия" name="name"></p>
										</div>
										<div class="form-group1">
											<p><label for="gender">Пол</label></p>
										<p><select class="form-control required" name="gender"><option value="">Не указан</option><option value="male">Мужской</option><option value="female">Женский</option></select></p>
										</div>
										<div class="form-group1">
											<p><label for="location">Местоположение</label></p>
											<p><input type="text" class="form-control required" placeholder="Страна, Область, Город" name="location"></p>
</div>	
<div class="form-group1">
	<p><label for="about">Об аккаунте</label></p>
	<p><input type="text" class="form-control required" placeholder="" name="about"></p>
</div>	
<div class="form-group1">
	<p><label for="Interests">Интересы (Перечисляйте через пробел):</label></p>
	<p><input type="text" class="form-control required" placeholder="" name="Interests"></p>
</div>
<div class="form-group1">
	<p><label for="avatar">Аватарка (соотношение сторон 1:1, квадратная)</label></p>
	<p><input type="text" class="form-control required" placeholder="URL-изображения" name="avatar"></p>
<div class="drdrop"><input type="button" id="addimg" data-storage="false" value="Загрузить аватарку" onclick="document.querySelector(&#39;#loadinp&#39;).click()" ></div><input id="loadinp" style="visibility: collapse; width: 0px;" type="file" onchange="upload(this.files[0])"><p></p>
</div>	
<h2 class="tt" onclick="spoiler('account_links'); return false">Ссылки (Соцсети, сайт и пр.) (Заполнять не обязательно)</h2>
<div id="account_links" class="terms" style="display: none;">
<div class="form-group1">
	<p><label for="website">Веб-сайт (Если есть)</label></p>
	<p><input type="text" class="form-control required" placeholder="http://" name="website"></p>
</div>	
<div class="form-group1">
	<p><label for="telegram">Телеграм</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Telegram" name="telegram"></p>
</div>	
<div class="form-group1">
	<p><label for="discord">Дискорд:</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Discord" name="discord"></p>
</div>	
<div class="form-group1">
	<p><label for="instagram">Инстаграм:</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Instagram" name="instagram"></p>
</div>	
<div class="form-group1">
	<p><label for="vkontakte">Вконтакте</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин VK.com" name="vkontakte"></p>
</div>	
<div class="form-group1">
	<p><label for="facebook">Facebook</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Facebook" name="facebook"></p>
</div>	
<div class="form-group1">
	<p><label for="twitter">Твиттер</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Twitter" name="twitter"></p>
</div>	
<div class="form-group1">
	<p><label for="skype">Скайп:</label></p>
	<p><input type="text" class="form-control required" placeholder="Логин в Скайпе" name="skype"></p>
</div>	
</div>
										<div class="form-group1">
											<br>
											<input type="button" onclick="	profile_save();" value="Сохранить профиль">
										</div>										
								</div>
							</div>										
						</div>
					</section>
				</div>

				<div id="footer_buffer"></div>
					<footer id="footer_wrapper">
						<div id="footer" class="padding_tb20 row">
							<div class="col-sm-12">
								<div class="footer2">Разработка и дизайн клиента - <a href="user.html?author=captain">@captain</a></div>
							</div>
						</div>
					</footer>
				<div class="clearfix"></div>
			</div>
		</div>
		<div class="clearfix"></div>
		<script type="text/javascript">
Init();
			mainMenu();

	if(0<$('.profile-update').length){
		var test_user=user.login;
	var key = localStorage.getItem(test_user);
		viz.api.getAccounts([test_user],function(err,response){
			if(!err){
				let json_metadata=response[0].json_metadata;
				let metadata;
				if(''==json_metadata){
					metadata={};
				}
				else{
					metadata=JSON.parse(json_metadata);
				}

				if(typeof metadata.profile == 'undefined'){
					metadata.profile={};
				}
				if(typeof metadata.profile.about !== 'undefined'){
					$('input[name=about]').val(metadata.profile.about);
	}
				if(typeof metadata.profile.interests !== 'undefined'){
					$('input[name=Interests]').val(metadata.profile.interests.join(' '));
	}
	if(typeof metadata.profile.name !== 'undefined'){
					$('input[name=name]').val(metadata.profile.name);
				}
				if(typeof metadata.profile.location !== 'undefined'){
					$('input[name=location]').val(metadata.profile.location);
				}
				if(typeof metadata.profile.website !== 'undefined'){
					$('input[name=website]').val(metadata.profile.website);
				}
				if(typeof metadata.profile.profile_image !== 'undefined'){
					$('input[name=avatar]').val(metadata.profile.profile_image);
				}
				if(typeof metadata.profile.telegram !== 'undefined'){
					$('input[name=telegram]').val(metadata.profile.telegram);
				}
				if(typeof metadata.profile.discord !== 'undefined'){
					$('input[name=discord]').val(metadata.profile.discord);
				}
				if(typeof metadata.profile.instagram !== 'undefined'){
					$('input[name=instagram]').val(metadata.profile.instagram);
				}
				if(typeof metadata.profile.vkontakte !== 'undefined'){
					$('input[name=vkontakte]').val(metadata.profile.vkontakte);
				}
				if(typeof metadata.profile.facebook !== 'undefined'){
					$('input[name=facebook]').val(metadata.profile.facebook);
				}
				if(typeof metadata.profile.twitter !== 'undefined'){
					$('input[name=twitter]').val(metadata.profile.twitter);
				}
				if(typeof metadata.profile.skype !== 'undefined'){
					$('input[name=skype]').val(metadata.profile.skype);
				}
				if(typeof metadata.profile.gender !== 'undefined'){
					$('select[name=gender]').val(metadata.profile.gender);
				}
			}
			else{
console.log(err);
			}
		});
	}

	function profile_save(){
		var test_user=user.login;
	var key = localStorage.getItem(test_user);
	var pk = sjcl.decrypt(test_user, key);

	let 					metadata={};
					metadata.profile={};
				metadata.profile.about=$('input[name=about]').val();
var fullInterests = $('input[name=Interests]').val();
	var i = fullInterests.split(' ');
	var i2 = [];
	i.forEach(function(item){
			i2.push(item.toLowerCase().trim());
				
	});
	i2 = unique(i2);
metadata.profile.interests = i2;
				metadata.profile.name=$('input[name=name]').val();
				metadata.profile.location=$('input[name=location]').val();
				metadata.profile.website=$('input[name=website]').val();
				metadata.profile.profile_image=$('input[name=avatar]').val();
				metadata.profile.telegram=$('input[name=telegram]').val();
				metadata.profile.discord=$('input[name=discord]').val();
				metadata.profile.instagram=$('input[name=instagram]').val();
								metadata.profile.vkontakte=$('input[name=vkontakte]').val();
												metadata.profile.facebook=$('input[name=facebook]').val();
																metadata.profile.twitter=$('input[name=twitter]').val();
																				metadata.profile.skype=$('input[name=skype]').val();
				metadata.profile.gender=$('.profile-update select[name=gender]').val();

				json_metadata=JSON.stringify(metadata);
				console.log(json_metadata);
				viz.broadcast.accountMetadata(pk,test_user,json_metadata,function(err, result){
					if(!err){
						window.alert('Ок. Ваш профиль сохранён.');
					}
					else{
						window.alert(err);
					}
				});
		}
   var featuredImage = [];
       window.ondragover = function(e) {e.preventDefault()}
       window.ondrop = function(e) {e.preventDefault(); upload(e.dataTransfer.files[0]); }
   function upload(file) {
       if (!file || !file.type.match(/image.*/)) return;
       document.getElementById("addimg").classList.add('Загрузка');
       var fd = new FormData();
       fd.append("image", file);
       var xhr = new XMLHttpRequest();
       xhr.open("POST", "https://api.imgur.com/3/image.json");
       xhr.onload = function() {
           var imgurl = JSON.parse(xhr.responseText).data.link;
   
$('input[name=avatar]').val(imgurl);
           featuredImage.push(imgurl);
           document.getElementById("addimg").classList.add('hasload');
   
   
       }
       xhr.setRequestHeader('Authorization', 'Client-ID 372d5f766d47d1d');
   
       xhr.send(fd);
   }

		</script>
	</body>
</html>
